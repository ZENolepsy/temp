<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>json파일 가져오기</title>

    <link rel="stylesheet" href="./resources/css/mystyle.css">

    <style>
        .print{
            width: 500px;
            height: 400px;
            border: 2px solid black;
            overflow-y: scroll;
        }
    </style>
</head>
<body>

    <div>
        <select id="selectRegion" onchange="f_searchRegion()">
            <option value="">=====전체=====</option>
        </select>
    </div>
    <div class="print" id="printData"></div>

    <!-- img나 script의 src 내용은 브라우저에서 실행될때 별도로 요청 후 적용된다. -->
    <script src="../project/youth.xml"></script>
    <script>
        // 현제 VS Code 제공하는 라이브 서버(웹서버)는 html-workspace 폴더를
        // 기준으로 서버가 동작중

        // 내 서버 폴더 안에 있는 파일에 대해 가져오고 싶다면?
        // -> 내 서버에게 AJAX 통신으로 해당 파일을 가져와야함

        // AJAX 통신 객체 생성
        let v_ajax = new XMLHttpRequest();

        v_ajax.open("GET", "./youth.json");

        let v_records = null;

        v_ajax.onload = function(){
            let v_json = JSON.parse(v_ajax.response);
            
            console.log(v_json);

            // v_json을 이용하여 div printData 에
            // 시도명 | 시군구명 | 10ℓ가격  형태로 전부 출력
            v_records = v_json["records"];

            for(let rec of v_records){
                let v_h2 = "<h2>" + rec["시도명"] + " | " + rec['시군구명'];
                    v_h2 += " | " + rec['10ℓ가격'] + "</h2>";
                
                v_printData.innerHTML += v_h2;
            }

            // json 객체는 key값이 유니크해야함
            let v_regions = {};
            for(let rec of v_records){
                // 각 데이터에서 시도명을 json 객체의 key값으로 추가
                v_regions[rec["시도명"]] = "0";
            }

            console.log(v_regions);

            // json 객체의 key값들로 구성된 배열 생성
            let v_regArray = Object.keys(v_regions);
            console.log(v_regArray);

            for(let reg of v_regArray){
                let v_option = document.createElement('option');
                v_option.innerHTML = reg;
                v_option.value = reg;

                document.querySelector('#selectRegion').append(v_option);
            }

        }

        v_ajax.send();

        
        let v_printData = document.getElementById("printData");

        function f_searchRegion(){
            console.log(event.target);
            console.log(event.target.value);
            let v_search = event.target.value;

            // v_records 를 쓰고 싶음
            console.log(v_records);

            v_printData.innerHTML = "";

            for(let rec of v_records){
                if(rec['시도명'] == v_search){
                    let v_h2 = "<h2>" + rec["시도명"] + " | " + rec['시군구명'];
                        v_h2 += " | " + rec['10ℓ가격'] + "</h2>";
                    
                    v_printData.innerHTML += v_h2;
                }
            }
        }

    </script>

</body>
</html>